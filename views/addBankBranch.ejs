

<input type="checkbox" name="" id="sideMenu_Toggle">

<%- include('common/sideMenu'); -%>

<!-- ===================main content============= -->
<div class="main_content">
 
  
  <%- include('common/header'); -%>

    <main>

        <div class="page_header">
            <div>
                <h1><%= title %></h1><br/>
                <!-- <small>Welcome ayt store. check reporting and review insights</small> -->
            </div>
        </div>     
        
        <hr class="line">

        <div class="form_section">
            <form class="row g-3 needs-validation" action="/addBranch" method="POST"  novalidate> <!--enctype="multipart/form-data"-->

                <% if(messages.error) { %>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <h4 class="alert-heading">Something went wrong !</h4>
                        <hr>
                        <p class="mb-0"><%= messages.error %></p>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %>   

                <% if(messages.success) { %>
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <h4 class="alert-heading">Success !</h4>
                        <hr>
                        <p class="mb-0"><%= messages.success %></p>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %> 

                <div class="col-md-4">
                    <label for="validationCustom01" class="form-label">Bank Code<span>*</span></label>
                    <!-- <% banks.forEach(function(bank) { %>
                        <p><%= bank.bank_name %></p>
                    <% }) %> -->


                    <select class="form-select input_field" id="validationCustom01" name="bank_code"  required>
                        <option value="">Select Bank Code</option>
                        <% banks.forEach(function(bank) { %>
                            <option value="<%= bank.bank_code %>"> <%= bank.bank_name %> </option>
                        <% }) %> 
                    </select>
                    <div class="invalid-feedback">
                        Please select a bank code.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom03" class="form-label">City Code<span>*</span></label>
                    <!-- <input type="number" class="form-control input_field" name="city_code" id="validationCustom03"  required> -->
                    <select class="form-select input_field" id="validationCustom03" name="city_code"  onchange="getCityName(this.value)"  required>
                        <option value="">Select City Code</option>
                        <% cities.forEach(function(city) { %>
                            <option value="<%= city.city_code %>"> <%= city.city_code %> </option>
                        <% }) %> 
                    </select>
                    <div class="invalid-feedback">
                        Please provide a City Code.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="cityName" class="form-label">City Name<span>*</span></label>
                    <input type="text" class="form-control input_field" name="city_name" readonly id="cityName"  required>
                    <!-- <select class="form-select input_field" id="cityName" readonly name="city_name"  required>
                        <option value="">Choose...</option>
                        <option value="city name 1" active>city name 1</option>
                        <option value="city name 1">city name 2</option>
                    </select> -->
                    <div class="invalid-feedback">
                        Please provide a City Name.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom02" class="form-label">Branch Name<span>*</span></label>
                    <input type="text" class="form-control input_field" name="branch_name" id="validationCustom02"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch Name.
                    </div>
                </div>

                

                <div class="col-md-4">
                    <label for="validationCustom05" class="form-label">Branch Scale<span>*</span></label>
                    <input type="text" class="form-control input_field" name="branch_scale" id="validationCustom05"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch Scale.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom06" class="form-label">Branch Contact - 1<span>*</span></label>
                    <input type="text" pattern="[0-9]{10}" class="form-control input_field" name="branch_contact_1" id="validationCustom06"  required>
                    <div class="invalid-feedback">
                        Please provide a 10 digit Branch Contact - 1.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom07" class="form-label">Branch Contact - 2<span>*</span></label>
                    <input type="text" pattern="[0-9]{10}" class="form-control input_field" name="branch_contact_2" id="validationCustom07"  required>
                    <div class="invalid-feedback">
                        Please provide a  10 digit Branch Contact - 2.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom08" class="form-label">Branch IFSC<span>*</span></label>
                    <input type="text" class="form-control input_field" name="branch_IFSC" id="validationCustom08"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch IFSC.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom09" class="form-label">Branch Section<span>*</span></label>
                    <input type="text" class="form-control input_field" name="branch_section" id="validationCustom09"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch Section.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom10" class="form-label">Branch Address<span>*</span></label>
                    <input type="text" class="form-control input_field" name="branch_address" id="validationCustom10"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch Address.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom11" class="form-label">Branch R.O Code<span>*</span></label>
                    <input type="text" class="form-control input_field" name="branch_RO_code" id="validationCustom11"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch R.O Code.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom12" class="form-label">Branch Email<span>*</span></label>
                    <input type="email" class="form-control input_field" name="branch_email" id="validationCustom12"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch Email.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom13" class="form-label">Branch Type<span>*</span></label>
                    <input type="text" class="form-control input_field" name="branch_type" id="validationCustom13"  required>
                    <div class="invalid-feedback">
                        Please provide a Branch Type.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom14" class="form-label">Status <span>*</span></label>
                    <select class="form-select input_field" id="validationCustom14" name="status"  required>
                        <option value="">Choose...</option>
                        <option value="Active" selected>Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                    <div class="invalid-feedback">
                        Please select a status.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom09" class="form-label">Create By<span>*</span></label>
                    <input type="text" class="form-control input_field" name="create_by" value="<%= userName %> - <%= userType %>" id="validationCustom09"  required readonly>
                    <div class="invalid-feedback">
                        Please provide a create By.
                    </div>
                </div>

               

                <div class="col-12 text-center mt-4 form_btn">
                   <button class="btn btn-sm btn-primary submit_btn" type="submit">Submit form</button> &nbsp;
                   <a href="/allBranches" class="btn btn-sm btn-dark submit_btn">Back</a>
                </div>
                <br/><br/><br/>
            </form>
        </div>    




    </main>
</div>

 

<script>
    $(document).ready(function(){
        $("#allBranches").addClass('active');
    })

    const uploadImg = document.querySelector('.uploadImg_div');
    function getImagePath(event){
      console.log(event);
      var file = URL.createObjectURL(event.target.files[0]);
      console.log(file);
      uploadImg.innerHTML = "<img src='"+file+"'>";
    }

    //====== disable select option =======
    //document.querySelector('#cityName').style.pointerEvents="none";

    function getCityName(city_code){
        //console.log(city_code);
        // ====using ajax===== 
        //1: ajax object xmlhttp
        //2: object request open
        //3: object send in server
        //4: process to check server state and status
        //5: get Response

        const cityNameId = document.getElementById('cityName')
        //console.log(cityNameId)
        cityNameId.value= "";

        const ajaxReq = new XMLHttpRequest(); // create object
        ajaxReq.open('GET','<%= serverUrl %>/getCityName/'+city_code,'TRUE'); // open request
        ajaxReq.send();
        ajaxReq.onreadystatechange = function(){
            if(ajaxReq.readyState == 4 && ajaxReq.status == 200){
                //console.log(ajaxReq.responseText);
                //console.log(ajaxReq.response)
                let cityNameResp = ajaxReq.response;
                let obj  = JSON.parse(cityNameResp);
                var cityName = obj.city_name;
                //console.log(cityName);                
                cityNameId.value= cityName;
            }
        }
    }
</script>
