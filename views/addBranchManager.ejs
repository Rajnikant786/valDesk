

<input type="checkbox" name="" id="sideMenu_Toggle">

<%- include('common/sideMenu'); -%>

<!-- ===================main content============= -->
<div class="main_content">
 
  
  <%- include('common/header'); -%>

    <main>

        <div class="page_header">
            <div>
                <h1><%= title %></h1><br/>
                <!-- <small>Welcome ayt store. check reporting and review insights</small> -->
            </div>
        </div>     
        
        <hr class="line">

        <div class="form_section">
            <form class="row g-3 needs-validation" action="/addBranchManager" method="POST" novalidate> <!-- enctype="multipart/form-data"-->

                <% if(messages.error) { %>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <h4 class="alert-heading">Something went wrong !</h4>
                        <hr>
                        <p class="mb-0"><%= messages.error %></p>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %>   

                <% if(messages.success) { %>
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <h4 class="alert-heading">Success !</h4>
                        <hr>
                        <p class="mb-0"><%= messages.success %></p>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %> 

                <div class="col-md-4">
                    <label for="bankCode" class="form-label">Bank Code<span>*</span></label>
                    <select class="form-select input_field" id="bankCode" name="bank_code" onchange="setInputAttribute(this.value)" required> <!--onchange="getBankCode(this.value)"-->
                        <option value="">Select Bank Code</option>
                        <% banks.forEach(function(bank) { %>
                            <option value="<%= bank.bank_code %>"> <%= bank.bank_code %> </option>
                        <% }) %>
                    </select>
                    <div class="invalid-feedback">
                        Please select a bank code.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="cityCode" class="form-label">City Code<span>*</span></label>
                    <!-- <input type="number" class="form-control input_field" name="city_code" id="validationCustom03"  required> -->
                    <select class="form-select input_field" id="cityCode" name="city_code"  onchange="getBranchName(this.value)"  required>
                        <option value="">Select City Code</option>
                        <% cities.forEach(function(city) { %>
                            <option value="<%= city.city_code %>"> <%= city.city_code %> </option>
                        <% }) %> 
                    </select>
                    <div class="invalid-feedback">
                        Please provide a City Code.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="branchName" class="form-label">Branch Name<span>*</span></label>
                    <select class="form-select input_field" id="branchName" name="branch_name"  required>
                        <option value="">Select Branch Name</option>

                    </select>
                    <div class="invalid-feedback">
                        Please select a bank code.
                    </div>
                </div>

                

                <div class="col-md-4">
                    <label for="validationCustom02" class="form-label">Manager Name<span>*</span></label>
                    <input type="text" class="form-control input_field" name="manager_name" id="validationCustom02"  required>
                    <div class="invalid-feedback">
                        Please provide a manager name.
                    </div>
                </div>  
                
                <div class="col-md-4">
                    <label for="validationCustom03" class="form-label">Manager Last Name<span>*</span></label>
                    <input type="text" class="form-control input_field" name="manager_last_name" id="validationCustom03"  required>
                    <div class="invalid-feedback">
                        Please provide a manager last name.
                    </div>
                </div> 

                <div class="col-md-4">
                    <label for="validationCustom02" class="form-label">Manager D.O.B<span>*</span></label>
                    <input type="date" max="2022-01-01" class="form-control input_field" name="manager_dob" id="validationCustom02"  required>
                    <div class="invalid-feedback">
                        Please provide a manager dob.
                    </div>
                </div> 

                <div class="col-md-4">
                    <label for="validationCustom03" class="form-label">Gender<span>*</span></label>
                    <select class="form-select input_field" id="validationCustom01" name="gender"  required>
                        <option value="">Choose...</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                    <div class="invalid-feedback">
                        Please provide a gender.
                    </div>
                </div> 

                <div class="col-md-4">
                    <label for="validationCustom04" class="form-label">Manager Scale<span>*</span></label>
                    <input type="text" class="form-control input_field" name="manager_scale" id="validationCustom04"  required>
                    <div class="invalid-feedback">
                        Please provide a manager scale.
                    </div>
                </div>
                
                <div class="col-md-4">
                    <label for="validationCustom05" class="form-label">Manager Designation<span>*</span></label>
                    <input type="text" class="form-control input_field" name="manager_designation" id="validationCustom05"  required>
                    <div class="invalid-feedback">
                        Please provide a manager Designation.
                    </div>
                </div> 
                
                <div class="col-md-4">
                    <label for="validationCustom06" class="form-label">Manager Official Number<span>*</span></label>
                    <input type="text" pattern="[0-9]{10}" class="form-control input_field" name="manager_official_number" id="validationCustom06"  required>
                    <div class="invalid-feedback">
                        Please provide a 10 digit manager official number.
                    </div>
                </div> 

                <div class="col-md-4">
                    <label for="validationCustom07" class="form-label">Manager Personal Number<span>*</span></label>
                    <input type="text" pattern="[0-9]{10}" class="form-control input_field" name="manager_personal_number" id="validationCustom07"  required>
                    <div class="invalid-feedback">
                        Please provide a 10 digit manager personal number.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom08" class="form-label">Manager Personal Email<span>*</span></label>
                    <input type="email" class="form-control input_field" name="manager_personal_email" id="validationCustom08"  required>
                    <div class="invalid-feedback">
                        Please provide a manager personal email.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom09" class="form-label">Manager Bank Email<span>*</span></label>
                    <input type="email" class="form-control input_field" name="manager_bank_email" id="validationCustom09"  required>
                    <div class="invalid-feedback">
                        Please provide a manager bank email.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom10" class="form-label">Address<span>*</span></label>
                    <input type="text" class="form-control input_field" name="manager_address" id="validationCustom10"  required>
                    <div class="invalid-feedback">
                        Please provide a address.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom11" class="form-label">Remarks<span>*</span></label>
                    <input type="text" class="form-control input_field" name="remarks" id="validationCustom11"  required>
                    <div class="invalid-feedback">
                        Please provide a remarks.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom12" class="form-label">Status <span>*</span></label>
                    <select class="form-select input_field" id="validationCustom12" name="status"  required>
                        <option value="">Choose...</option>
                        <option value="Active" selected>Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                    <div class="invalid-feedback">
                       Please select a status.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="validationCustom13" class="form-label">Create By<span>*</span></label>
                    <input type="text" class="form-control input_field" name="create_by" value="<%= userName %> - <%= userType %>" id="validationCustom13"  required readonly>
                    <div class="invalid-feedback">
                        Please provide a create By.
                    </div>
                </div>

                <div class="col-12 text-center mt-4 form_btn">
                   <button class="btn btn-sm btn-primary submit_btn" type="submit">Submit form</button> &nbsp;
                   <a href="/allBranchManagers" class="btn btn-sm btn-dark submit_btn">Back</a>
                </div>
                <br/><br/><br/>
            </form>
        </div>    




    </main>
</div>

 

<script>
    $(document).ready(function(){
        $("#allBranchManager").addClass('active');
    })

    const uploadImg = document.querySelector('.uploadImg_div');
    function getImagePath(event){
      console.log(event);
      var file = URL.createObjectURL(event.target.files[0]);
      console.log(file);
      uploadImg.innerHTML = "<img src='"+file+"'>";
    }

    function getBankCode(bank_code){
        //alert(bank_code)
        //console.log("bank code is :-"+ bank_code)

        // ====using ajax===== 
        //1: ajax object xmlhttp
        //2: object request open
        //3: object send in server
        //4: process to check server state and status
        //5: get Response

        const ajaxReq = new XMLHttpRequest(); // create object
        ajaxReq.open('GET','<%= serverUrl %>/getBranchName/'+bank_code,'TRUE'); // open request
        ajaxReq.send();
        ajaxReq.onreadystatechange = function(){
            if(ajaxReq.readyState == 4 && ajaxReq.status == 200){
                //console.log(ajaxReq.responseText);
                //console.log(ajaxReq.response)
                let bankName = ajaxReq.response;
                let obj  = JSON.parse(bankName);
                //console.log(obj.bankNames);

                const branchNameId = document.getElementById('branchName')
                //console.log(branchNameId)

                branchNameId.innerHTML = '<option value="">Choose ...</option>';
                if(obj.bankNames.length > 0){
                    for(let i=0; i<obj.bankNames.length; i++){
                        //console.log(obj.bankNames[i]);
                        console.log(obj.bankNames[i].branch_name);                    
                        var newOption = document.createElement("option");
                        newOption.value=obj.bankNames[i].branch_name
                        newOption.innerHTML=obj.bankNames[i].branch_name
                        branchNameId.options.add(newOption);
                    }
                }else{
                    //branchNameId.innerHTML = '<option value="">Choose Branch Name ...</option>';
                    alert("No any branch name in this bank");
                }
                
            }
        }
    }

    //$("#cityCode").disabled = "True";
    //$(selector_name).attr(‘disabled’, ‘disabled’);

    cityCodeInput = document.getElementById('cityCode')
    cityCodeInput.disabled = "True";

    function setInputAttribute(bank_code){
        cityCodeInput.disabled = "";
        if(bank_code){
            //console.log(bank_code);
            cityCodeInput.disabled = "";
        }
        else{
            //console.log("no selected")
            cityCodeInput.disabled = "True";
        }
        //var cityValue = cityCodeInput.value;
        cityCodeInput.value = "";
    }
        
    function getBranchName(city_code){
        bankCodeValue = document.getElementById('bankCode');        
        var bank_code = bankCodeValue.value
        //console.log(bank_code)
        //console.log(city_code)

        // ====using ajax===== 
        //1: ajax object xmlhttp
        //2: object request open
        //3: object send in server
        //4: process to check server state and status
        //5: get Response


        const ajaxReq = new XMLHttpRequest(); // create object
        ajaxReq.open('GET',"<%= serverUrl %>/getBranchName/"+bank_code+"/"+city_code,'TRUE'); // open request
        ajaxReq.send();
        ajaxReq.onreadystatechange = function(){
            if(ajaxReq.readyState == 4 && ajaxReq.status == 200){
                //console.log(ajaxReq.responseText);
                //console.log(ajaxReq.response)
                let bankName = ajaxReq.response;
                let obj  = JSON.parse(bankName);
                //console.log(obj.bankNames);

                const branchNameId = document.getElementById('branchName')
                //console.log(branchNameId)

                branchNameId.innerHTML = '<option value="">Choose ...</option>';
                if(obj.bankNames.length > 0){
                    for(let i=0; i<obj.bankNames.length; i++){
                        //console.log(obj.bankNames[i]);
                        //console.log(obj.bankNames[i].branch_name);                    
                        var newOption = document.createElement("option");
                        newOption.value=obj.bankNames[i].branch_name
                        newOption.innerHTML=obj.bankNames[i].branch_name
                        branchNameId.options.add(newOption);
                    }
                }else{
                    //branchNameId.innerHTML = '<option value="">Choose Branch Name ...</option>';
                    alert("No any branch name in this bank or city");
                }
                
            }
        }
    }

</script>
